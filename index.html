<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- for youu :33 Ganti dengan judul yang kamu mau -->
    <title>for youu :33</title>
    <link href="https://fonts.googleapis.com/css2?family=Chewy&display=swap" rel="stylesheet">
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Chewy', cursive;
            background-color: #E5FOFA;
            background-image: url('https://raw.githubusercontent.com/cargift/image/main/d3d09b98db694c61b5f0e51dfca53a0a.jpg');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            color: #1e3b5c;
        }

        .container {
            max-width: 650px;
            width: 100%;
            text-align: center;
            background-color: rgba(209, 232, 252, 0.7);
            backdrop-filter: blur(4px);
            border-radius: 60px 60px 40px 40px;
            padding: 25px 20px 35px 20px;
            box-shadow: 0 12px 28px rgba(0, 40, 80, 0.3);
            border: 3px solid #A2D2FF;
        }

        h1 {
            color: #0f4c75;
            font-size: 2.8rem;
            margin-bottom: 0;
            letter-spacing: 2px;
            text-shadow: 3px 3px 0 #BDEOFE;
        }

        h2 {
            color: #1b4f72;
            font-size: 1.4rem;
            margin-top: 0;
            background-color: rgba(255,255,240,0.3);
            display: inline-block;
            padding: 0.3rem 1.2rem;
            border-radius: 60px;
            backdrop-filter: blur(2px);
        }

        .image-selection {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .image-selection h3 {
            color: #11698e;
            font-size: 1.7rem;
            margin: 15px 0 10px;
        }

        .image-options {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 18px;
            margin: 20px 0 25px;
        }

        .image-option {
            width: 160px;
            height: 160px;
            border-radius: 30px 10px 30px 10px;
            overflow: hidden;
            cursor: pointer;
            transition: all 0.2s ease;
            border: 4px solid transparent;
            box-shadow: 0 10px 15px rgba(0, 30, 60, 0.2);
        }

        .image-option:hover {
            transform: scale(1.07) rotate(1deg);
            border-color: #8FC9FF;
            box-shadow: 0 12px 25px #A2D2FF;
        }

        .image-option.selected {
            border-color: #0f4c75;
            border-width: 4px;
            box-shadow: 0 0 0 4px #D1E8FC, 0 12px 20px #1e3b5c;
        }

        .image-option img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
        }

        .puzzle-screen {
            display: none;
        }

        .puzzle-container {
            width: 100%;
            height: 400px;
            background-color: #BDEOFE;
            border-radius: 45px;
            box-shadow: 0 10px 25px #1e3b5c;
            margin: 25px 0 20px;
            padding: 12px;
            position: relative;
            border: 4px solid #A2D2FF;
        }

        .puzzle-board {
            width: 100%;
            height: 100%;
            position: relative;
            background-color: #E5FOFA;
            border-radius: 30px;
            border: 2px dashed #8FC9FF;
            overflow: hidden;
            touch-action: none;
        }

        .puzzle-piece {
            position: absolute;
            background-size: cover;
            border-radius: 16px;
            box-shadow: 0 6px 12px rgba(0,30,60,0.3);
            cursor: grab;
            transition: box-shadow 0.2s;
            border: 2px solid #ffffff90;
            z-index: 1;
            will-change: left, top;
            pointer-events: auto;
        }

        .puzzle-piece:hover {
            filter: brightness(1.02);
            box-shadow: 0 12px 20px #0f4c75;
        }

        .puzzle-piece.dragging {
            cursor: grabbing;
            transform: scale(1.02);
            box-shadow: 0 16px 28px #1e3b5c;
            z-index: 999 !important;
            opacity: 0.95;
            transition: none;
        }

        .puzzle-piece.correct {
            cursor: default;
            border: 3px solid #8FC9FF;
            box-shadow: 0 0 0 3px #A2D2FF, 0 6px 14px #1b4f72;
            animation: softGlow 2s infinite;
            pointer-events: none;
            z-index: 2;
        }

        @keyframes softGlow {
            0% { filter: drop-shadow(0 0 2px #8FC9FF); }
            50% { filter: drop-shadow(0 0 8px #A2D2FF); }
            100% { filter: drop-shadow(0 0 2px #8FC9FF); }
        }

        .completion-message {
            display: none;
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(209, 232, 252, 0.9);
            backdrop-filter: blur(5px);
            flex-direction: column;
            justify-content: center;
            align-items: center;
            border-radius: 30px;
            z-index: 200;
            padding: 20px;
            border: 4px solid #A2D2FF;
        }

        .completion-message h3 {
            color: #0f4c75;
            font-size: 2.2rem;
            margin-bottom: 15px;
            text-shadow: 2px 2px 0 #BDEOFE;
        }

        .btn {
            background-color: #A2D2FF;
            color: #0f2b44;
            border: 3px solid #ffffff;
            padding: 12px 28px;
            border-radius: 50px;
            font-family: 'Chewy', cursive;
            font-size: 1.3rem;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 6px 0 #8FC9FF, 0 8px 16px #00000020;
            transition: all 0.12s;
            margin: 10px 8px;
            letter-spacing: 1px;
        }

        .btn:hover {
            background-color: #8FC9FF;
            transform: translateY(-4px);
            box-shadow: 0 8px 0 #7bb2e6, 0 12px 20px #0f4c75;
        }

        .btn:active {
            transform: translateY(4px);
            box-shadow: 0 2px 0 #7bb2e6, 0 6px 12px #1e3b5c;
        }

        .move-counter {
            margin-top: 10px;
            font-size: 1.6rem;
            color: #0f4c75;
            background: #E5FOFA;
            padding: 5px 20px;
            border-radius: 40px;
            display: inline-block;
            border: 3px solid #8FC9FF;
        }

        #currentMoves, #moveCount {
            font-weight: bold;
            background: #D1E8FC;
            padding: 0 10px;
            border-radius: 30px;
        }

        .heart {
            position: absolute;
            pointer-events: none;
            opacity: 0;
            animation: floatUp 2.5s ease-out forwards;
            z-index: 9999;
            filter: drop-shadow(0 0 6px #ffb6c1);
            font-size: 24px;
        }

        @keyframes floatUp {
            0% { transform: translateY(0) scale(0.8); opacity: 1; }
            100% { transform: translateY(-120px) scale(1.4); opacity: 0; }
        }

        @media (max-width: 550px) {
            .container { padding: 15px; }
            h1 { font-size: 2.3rem; }
            .puzzle-container { height: 340px; }
            .image-option { width: 130px; height: 130px; }
            .btn { font-size: 1.1rem; padding: 8px 18px; }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>for youu :33</h1>

        <div class="image-selection" id="imageSelection">
            <h3>choose the picture</h3>
            <div class="image-options">
                <div class="image-option" data-image="images/photo_8363366918_1771693395.jpg">
                    <img src="images/photo_8363366918_1771693395.jpg" alt="puzzle 1" loading="lazy" onerror="this.src='https://via.placeholder.com/200?text=Image+1'">
                </div>
                <div class="image-option" data-image="images/photo_8363366918_1771693411.jpg">
                    <img src="images/photo_8363366918_1771693411.jpg" alt="puzzle 2" loading="lazy" onerror="this.src='https://via.placeholder.com/200?text=Image+2'">
                </div>
                <div class="image-option" data-image="images/photo_8363366918_1771693440.jpg">
                    <img src="images/photo_8363366918_1771693440.jpg" alt="puzzle 3" loading="lazy" onerror="this.src='https://via.placeholder.com/200?text=Image+3'">
                </div>
            </div>
            <button class="btn" id="startBtn">Mulai puzzle</button>
        </div>

        <div class="puzzle-screen" id="puzzleScreen">
            <div class="puzzle-container">
                <div class="puzzle-board" id="puzzleBoard"></div>
                <div class="completion-message" id="completionMessage">
                    <h3>you finished that!</h3>
                    <div class="move-counter">langkah: <span id="moveCount">0</span></div>
                    <div>
                        <button class="btn" id="replayBtn">main lagi</button>
                        <button class="btn" id="changeImageBtn">ganti gambar</button>
                    </div>
                </div>
            </div>
            <div class="move-counter"> Langkah: <span id="currentMoves">0</span></div>
        </div>
    </div>

    <script>
        (function() {
            const imageSelection = document.getElementById('imageSelection');
            const puzzleScreen = document.getElementById('puzzleScreen');
            const puzzleBoard = document.getElementById('puzzleBoard');
            const completionMsg = document.getElementById('completionMessage');
            const startBtn = document.getElementById('startBtn');
            const replayBtn = document.getElementById('replayBtn');
            const changeImageBtn = document.getElementById('changeImageBtn');
            const moveCountSpan = document.getElementById('moveCount');
            const currentMovesSpan = document.getElementById('currentMoves');

            let selectedImage = null;
            let pieces = [];
            let correctCount = 0;
            let moves = 0;
            let pieceW, pieceH;
            let boardW, boardH;
            let activePiece = null;
            let initialZIndices = [];

            const imageOptions = document.querySelectorAll('.image-option');
            imageOptions.forEach(opt => {
                opt.addEventListener('click', function() {
                    imageOptions.forEach(o => o.classList.remove('selected'));
                    this.classList.add('selected');
                    selectedImage = this.dataset.image;
                });
            });

            startBtn.addEventListener('click', () => {
                if (!selectedImage) {
                    alert('pilih gambar dulu ya');
                    return;
                }
                imageSelection.style.display = 'none';
                puzzleScreen.style.display = 'block';
                initPuzzle();
            });

            function initPuzzle() {
                puzzleBoard.innerHTML = '';
                pieces = [];
                correctCount = 0;
                moves = 0;
                currentMovesSpan.textContent = '0';
                completionMsg.style.display = 'none';
                activePiece = null;

                boardW = puzzleBoard.clientWidth;
                boardH = puzzleBoard.clientHeight;

                pieceW = boardW / 3;
                pieceH = boardH / 3;

                createPieces();
                shufflePieces();
                
                initialZIndices = pieces.map((_, index) => index + 1);
                resetZIndices();
            }

            function resetZIndices() {
                pieces.forEach((piece, index) => {
                    if (!piece.classList.contains('correct')) {
                        piece.style.zIndex = initialZIndices[index];
                    }
                });
            }

            function createPieces() {
                for (let r = 0; r < 3; r++) {
                    for (let c = 0; c < 3; c++) {
                        const piece = document.createElement('div');
                        piece.className = 'puzzle-piece';
                        piece.dataset.row = r;
                        piece.dataset.col = c;
                        piece.dataset.correct = 'false';

                        piece.style.width = pieceW + 'px';
                        piece.style.height = pieceH + 'px';

                        piece.style.backgroundImage = `url('${selectedImage}')`;
                        piece.style.backgroundPosition = `${-c * pieceW}px ${-r * pieceH}px`;
                        piece.style.backgroundSize = `${boardW}px ${boardH}px`;

                        const correctX = c * pieceW;
                        const correctY = r * pieceH;
                        piece.dataset.correctX = correctX;
                        piece.dataset.correctY = correctY;

                        piece.style.left = '0px';
                        piece.style.top = '0px';

                        attachDragEvents(piece);
                        puzzleBoard.appendChild(piece);
                        pieces.push(piece);
                    }
                }
            }

            function shufflePieces() {
                const gridSize = 3;
                const positions = [];
                
                for (let r = 0; r < gridSize; r++) {
                    for (let c = 0; c < gridSize; c++) {
                        positions.push({
                            x: c * pieceW,
                            y: r * pieceH
                        });
                    }
                }

                for (let i = positions.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [positions[i], positions[j]] = [positions[j], positions[i]];
                }

                pieces.forEach((piece, index) => {
                    if (index < positions.length) {
                        piece.style.left = positions[index].x + 'px';
                        piece.style.top = positions[index].y + 'px';
                    }
                    piece.classList.remove('correct');
                    piece.dataset.correct = 'false';
                    piece.style.zIndex = initialZIndices[index] || (index + 1);
                });
                
                correctCount = 0;
            }

            function bringToTop(element) {
                const maxZ = Math.max(...pieces.map(p => {
                    const z = window.getComputedStyle(p).zIndex;
                    return z === 'auto' ? 0 : parseInt(z, 10);
                })) + 1;
                
                element.style.zIndex = maxZ;
            }

            function attachDragEvents(piece) {
                let dragging = false;
                let startX, startY;
                let startLeft, startTop;
                let hasMoved = false;

                const dragStart = (e) => {
                    if (piece.dataset.correct === 'true') return;
                    
                    e.preventDefault();
                    e.stopPropagation();

                    dragging = true;
                    hasMoved = false;
                    activePiece = piece;
                    
                    piece.classList.add('dragging');
                    bringToTop(piece);

                    const clientX = e.type.startsWith('touch') ? e.touches[0].clientX : e.clientX;
                    const clientY = e.type.startsWith('touch') ? e.touches[0].clientY : e.clientY;

                    const rect = piece.getBoundingClientRect();
                    startX = clientX - rect.left;
                    startY = clientY - rect.top;

                    startLeft = parseFloat(piece.style.left) || 0;
                    startTop = parseFloat(piece.style.top) || 0;

                    window.addEventListener('mousemove', dragMove);
                    window.addEventListener('touchmove', dragMove, { passive: false });
                    window.addEventListener('mouseup', dragEnd);
                    window.addEventListener('touchend', dragEnd);
                };

                const dragMove = (e) => {
                    if (!dragging || !activePiece) return;
                    e.preventDefault();

                    hasMoved = true;

                    let clientX, clientY;
                    if (e.type === 'touchmove') {
                        clientX = e.touches[0].clientX;
                        clientY = e.touches[0].clientY;
                    } else {
                        clientX = e.clientX;
                        clientY = e.clientY;
                    }

                    const boardRect = puzzleBoard.getBoundingClientRect();
                    
                    let newLeft = clientX - boardRect.left - startX;
                    let newTop = clientY - boardRect.top - startY;

                    newLeft = Math.max(0, Math.min(newLeft, boardW - pieceW));
                    newTop = Math.max(0, Math.min(newTop, boardH - pieceH));

                    piece.style.left = newLeft + 'px';
                    piece.style.top = newTop + 'px';
                };

                const dragEnd = (e) => {
                    if (!dragging) return;

                    window.removeEventListener('mousemove', dragMove);
                    window.removeEventListener('touchmove', dragMove);
                    window.removeEventListener('mouseup', dragEnd);
                    window.removeEventListener('touchend', dragEnd);

                    if (activePiece) {
                        activePiece.classList.remove('dragging');
                        
                        if (hasMoved) {
                            moves++;
                            currentMovesSpan.textContent = moves;
                        }

                        checkCorrect(activePiece);
                        
                        if (activePiece.dataset.correct === 'false') {
                            resetZIndices();
                        }
                        
                        activePiece = null;
                    }
                    
                    dragging = false;
                };

                piece.addEventListener('mousedown', dragStart);
                piece.addEventListener('touchstart', dragStart, { passive: false });
            }

            function checkCorrect(piece) {
                if (piece.dataset.correct === 'true') return;

                const correctX = parseFloat(piece.dataset.correctX);
                const correctY = parseFloat(piece.dataset.correctY);
                const currX = parseFloat(piece.style.left);
                const currY = parseFloat(piece.style.top);

                const threshold = 20;
                if (Math.abs(currX - correctX) < threshold && Math.abs(currY - correctY) < threshold) {
                    piece.style.left = correctX + 'px';
                    piece.style.top = correctY + 'px';
                    piece.classList.add('correct');
                    piece.dataset.correct = 'true';
                    piece.style.zIndex = 2;
                    correctCount++;

                    if (correctCount === 9) {
                        showCompletion();
                    }
                }
            }

            function showCompletion() {
                completionMsg.style.display = 'flex';
                moveCountSpan.textContent = moves;

                for (let i = 0; i < 15; i++) {
                    setTimeout(() => createHeart(), i * 100);
                }
            }

            function createHeart() {
                const heart = document.createElement('div');
                heart.innerHTML = '❤️';
                heart.className = 'heart';
                heart.style.left = Math.random() * 90 + 5 + '%';
                heart.style.bottom = '10px';
                heart.style.fontSize = (Math.random() * 24 + 16) + 'px';
                heart.style.opacity = '0.8';
                puzzleBoard.appendChild(heart);
                setTimeout(() => heart.remove(), 2500);
            }

            replayBtn.addEventListener('click', () => {
                initPuzzle();
            });

            changeImageBtn.addEventListener('click', () => {
                puzzleScreen.style.display = 'none';
                imageSelection.style.display = 'flex';
                imageOptions.forEach(o => o.classList.remove('selected'));
                selectedImage = null;
            });

            if (imageOptions.length > 0) {
                imageOptions[0].click();
            }

            window.addEventListener('resize', () => {
                if (puzzleScreen.style.display === 'block') {
                    initPuzzle();
                }
            });

            puzzleBoard.addEventListener('dragover', (e) => e.preventDefault());
            puzzleBoard.addEventListener('drop', (e) => e.preventDefault());
        })();
    </script>
</body>
</html>
